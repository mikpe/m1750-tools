<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.50
     from ld.texinfo on 20 November 1996 -->

<TITLE>Using LD, the GNU linker - PHDRS</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="ld_1.html">first</A>, <A HREF="ld_21.html">previous</A>, <A HREF="ld_23.html">next</A>, <A HREF="ld_33.html">last</A> section, <A HREF="ld_toc.html">table of contents</A>.
<P><HR><P>


<H2><A NAME="SEC22" HREF="ld_toc.html#TOC22">ELF Program Headers</A></H2>
<P>
<A NAME="IDX301"></A>
<A NAME="IDX302"></A>
<A NAME="IDX303"></A>

</P>
<P>
The ELF object file format uses <STRONG>program headers</STRONG>, which are read by
the system loader and describe how the program should be loaded into
memory.  These program headers must be set correctly in order to run the
program on a native ELF system.  The linker will create reasonable
program headers by default.  However, in some cases, it is desirable to
specify the program headers more precisely; the <CODE>PHDRS</CODE> command may
be used for this purpose.  When the <CODE>PHDRS</CODE> command is used, the
linker will not generate any program headers itself.

</P>
<P>
The <CODE>PHDRS</CODE> command is only meaningful when generating an ELF
output file.  It is ignored in other cases.  This manual does not
describe the details of how the system loader interprets program
headers; for more information, see the ELF ABI.  The program headers of
an ELF file may be displayed using the <SAMP>`-p'</SAMP> option of the
<CODE>objdump</CODE> command.

</P>
<P>
This is the syntax of the <CODE>PHDRS</CODE> command.  The words <CODE>PHDRS</CODE>,
<CODE>FILEHDR</CODE>, <CODE>AT</CODE>, and <CODE>FLAGS</CODE> are keywords.

</P>

<PRE>
PHDRS
{
  <VAR>name</VAR> <VAR>type</VAR> [ FILEHDR ] [ PHDRS ] [ AT ( <VAR>address</VAR> ) ]
        [ FLAGS ( <VAR>flags</VAR> ) ] ;
}
</PRE>

<P>
The <VAR>name</VAR> is used only for reference in the <CODE>SECTIONS</CODE> command
of the linker script.  It does not get put into the output file.

</P>
<P>
Certain program header types describe segments of memory which are
loaded from the file by the system loader.  In the linker script, the
contents of these segments are specified by directing allocated output
sections to be placed in the segment.  To do this, the command
describing the output section in the <CODE>SECTIONS</CODE> command should use
<SAMP>`:<VAR>name</VAR>'</SAMP>, where <VAR>name</VAR> is the name of the program header
as it appears in the <CODE>PHDRS</CODE> command.  See section <A HREF="ld_21.html#SEC21">Optional Section Attributes</A>.

</P>
<P>
It is normal for certain sections to appear in more than one segment.
This merely implies that one segment of memory contains another.  This
is specified by repeating <SAMP>`:<VAR>name</VAR>'</SAMP>, using it once for each
program header in which the section is to appear.

</P>
<P>
If a section is placed in one or more segments using <SAMP>`:<VAR>name</VAR>'</SAMP>,
then all subsequent allocated sections which do not specify
<SAMP>`:<VAR>name</VAR>'</SAMP> are placed in the same segments.  This is for
convenience, since generally a whole set of contiguous sections will be
placed in a single segment.  To prevent a section from being assigned to
a segment when it would normally default to one, use <CODE>:NONE</CODE>.

</P>
<P>
The <CODE>FILEHDR</CODE> and <CODE>PHDRS</CODE> keywords which may appear after the
program header type also indicate contents of the segment of memory.
The <CODE>FILEHDR</CODE> keyword means that the segment should include the ELF
file header.  The <CODE>PHDRS</CODE> keyword means that the segment should
include the ELF program headers themselves.

</P>
<P>
The <VAR>type</VAR> may be one of the following.  The numbers indicate the
value of the keyword.

</P>
<DL COMPACT>

<DT><CODE>PT_NULL</CODE> (0)
<DD>
Indicates an unused program header.

<DT><CODE>PT_LOAD</CODE> (1)
<DD>
Indicates that this program header describes a segment to be loaded from
the file.

<DT><CODE>PT_DYNAMIC</CODE> (2)
<DD>
Indicates a segment where dynamic linking information can be found.

<DT><CODE>PT_INTERP</CODE> (3)
<DD>
Indicates a segment where the name of the program interpreter may be
found.

<DT><CODE>PT_NOTE</CODE> (4)
<DD>
Indicates a segment holding note information.

<DT><CODE>PT_SHLIB</CODE> (5)
<DD>
A reserved program header type, defined but not specified by the ELF
ABI.

<DT><CODE>PT_PHDR</CODE> (6)
<DD>
Indicates a segment where the program headers may be found.

<DT><VAR>expression</VAR>
<DD>
An expression giving the numeric type of the program header.  This may
be used for types not defined above.
</DL>

<P>
It is possible to specify that a segment should be loaded at a
particular address in memory.  This is done using an <CODE>AT</CODE>
expression.  This is identical to the <CODE>AT</CODE> command used in the
<CODE>SECTIONS</CODE> command (see section <A HREF="ld_21.html#SEC21">Optional Section Attributes</A>).  Using the <CODE>AT</CODE>
command for a program header overrides any information in the
<CODE>SECTIONS</CODE> command.

</P>
<P>
Normally the segment flags are set based on the sections.  The
<CODE>FLAGS</CODE> keyword may be used to explicitly specify the segment
flags.  The value of <VAR>flags</VAR> must be an integer.  It is used to
set the <CODE>p_flags</CODE> field of the program header.

</P>
<P>
Here is an example of the use of <CODE>PHDRS</CODE>.  This shows a typical set
of program headers used on a native ELF system.

</P>

<PRE>
PHDRS
{
  headers PT_PHDR PHDRS ;
  interp PT_INTERP ;
  text PT_LOAD FILEHDR PHDRS ;
  data PT_LOAD ;
  dynamic PT_DYNAMIC ;
}

SECTIONS
{
  . = SIZEOF_HEADERS;
  .interp : { *(.interp) } :text :interp
  .text : { *(.text) } :text
  .rodata : { *(.rodata) } /* defaults to :text */
  ...
  . = . + 0x1000; /* move to a new page in memory */
  .data : { *(.data) } :data
  .dynamic : { *(.dynamic) } :data :dynamic
  ...
}
</PRE>

<P><HR><P>
Go to the <A HREF="ld_1.html">first</A>, <A HREF="ld_21.html">previous</A>, <A HREF="ld_23.html">next</A>, <A HREF="ld_33.html">last</A> section, <A HREF="ld_toc.html">table of contents</A>.
</BODY>
</HTML>
